<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.7.2"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="How can I better protect my Azure functions with OAuth?" /><meta name="author" content="Francois LEON" /><meta property="og:locale" content="en_US" /><meta name="description" content="Introduction" /><meta property="og:description" content="Introduction" /><link rel="canonical" href="https://scomnewbie.github.io//posts/authenticatedazfunc/" /><meta property="og:url" content="https://scomnewbie.github.io//posts/authenticatedazfunc/" /><meta property="og:site_name" content="SCOMnewbie learnings" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-02-09T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How can I better protect my Azure functions with OAuth?" /><meta name="twitter:site" content="@fanfleon" /><meta name="twitter:creator" content="@Francois LEON" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Francois LEON"},"description":"Introduction","url":"https://scomnewbie.github.io//posts/authenticatedazfunc/","@type":"BlogPosting","headline":"How can I better protect my Azure functions with OAuth?","dateModified":"2021-02-09T00:00:00+01:00","datePublished":"2021-02-09T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://scomnewbie.github.io//posts/authenticatedazfunc/"},"@context":"https://schema.org"}</script><title>How can I better protect my Azure functions with OAuth? | SCOMnewbie learnings</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" href="/assets/css/post.css" as="style"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-7JY58BKWDR"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-7JY58BKWDR'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/commons/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">SCOMnewbie learnings</a></div><div class="site-subtitle font-italic">A text-focused Jekyll theme</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tabs/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tabs/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/tabs/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tabs/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/SCOMnewbie" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/fanfleon" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['francois.leon','hotmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>How can I better protect my Azure functions with OAuth?</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>How can I better protect my Azure functions with OAuth?</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Feb 9, 2021, 12:00 AM +0100" > Feb 9 <i class="unloaded">2021-02-09T00:00:00+01:00</i> </span> by <span class="author"> Francois LEON </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="862 words">4 min</span></div></div><div class="post-content"><h1 id="introduction">Introduction</h1><p>Following a question from <a href="https://twitter.com/sstranger/status/1359056537378029569?s=20">Stefan Stranger</a>, it seems there is not a lot of documentation on the subject. The goal here will be to simply enable OAUth on top of an app service plan with easy auth (you can do custom as well if you prefer). I’m far to be a guru with Az functions (it’s in my to do list), if I say something stupid, just give me a feedback on Twitter I don’t bite. To do this, you will need at least GA/App admin or cloud App admin role because we will need a new app registration.</p><h1 id="demo">Demo</h1><p>I won’t document this part, but to play with a function, you need …. A function … I will assume that if you’re here, you’re not a beginner and you should know what you’re doing. So once we’ve create our RG and our function app, let’s start by running few commands to make sure everything is fine.</p><p>Here our function app:</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="w">
</span><span class="kr">using</span><span class="w"> </span><span class="kr">namespace</span><span class="w"> </span><span class="n">System.Net</span><span class="w">

</span><span class="c"># Input bindings are passed in via param block.</span><span class="w">
</span><span class="kr">param</span><span class="p">(</span><span class="nv">$Request</span><span class="p">,</span><span class="w"> </span><span class="nv">$TriggerMetadata</span><span class="p">)</span><span class="w">

</span><span class="c"># Interact with query parameters or the body of the request.</span><span class="w">
</span><span class="nv">$name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$Request</span><span class="o">.</span><span class="nf">Query</span><span class="o">.</span><span class="nf">Name</span><span class="w">
</span><span class="nv">$body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Hello, </span><span class="nv">$name</span><span class="s2">. This HTTP triggered function executed successfully."</span><span class="w">
</span><span class="c"># Associate values to output bindings by calling 'Push-OutputBinding'.</span><span class="w">
</span><span class="n">Push-OutputBinding</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="nx">Response</span><span class="w"> </span><span class="nt">-Value</span><span class="w"> </span><span class="p">([</span><span class="n">HttpResponseContext</span><span class="p">]@{</span><span class="w">
    </span><span class="nx">StatusCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">HttpStatusCode</span><span class="p">]</span><span class="err">::</span><span class="nx">OK</span><span class="w">
    </span><span class="nx">Body</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$body</span><span class="w">
</span><span class="p">})</span><span class="w">

</span></pre></table></code></div></div><p>Just provide a parameter name in the query string and we should be good to go</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># Here you can use anonymous if you prefer</span><span class="w">
</span><span class="nv">$Uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://testfuncaadfanf.azurewebsites.net/api/httpNoRole?code=EpogLPlkqeSiVlOOvQ73fAnHSfLC8ZSMMz4KrRpEcckNvgxCf/81fw==&amp;name=fanf"</span><span class="w"> </span><span class="c">#Not a real URL</span><span class="w">
</span><span class="n">Invoke-RestMethod</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="nv">$URI</span><span class="w">

</span></pre></table></code></div></div><p>And you should receive: <strong>Hello, fanf. This HTTP triggered function executed successfully</strong>. Cool it’s working, let’s now enable <strong>easy auth</strong>. Go in the <strong>function app tile</strong>, and click on <strong>Authentication/Authorization</strong> and then <strong>select On to the App Service Authentication</strong> button.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-02-10/01.png" alt="01" /></p><p>Now make sure to <strong>redirect all anonymous requests to AAD</strong>:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-02-10/02.png" alt="02" /></p><p>And select the <strong>express</strong> configuration (This is where you need GA/App admin rights)</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-02-10/03.png" alt="03" /></p><p>At this point, if you now retry the previous script, you will receive a <strong>401 unauthorized</strong> because for now, requests <strong>have to be authenticated</strong>!</p><div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> What I consider super cool here is that even if someone try to DDOS your function (anonymous or not), the DDOS requests will be blocked before the function execution. In other words, you can’t have a crazy bill at the end of the month, even with consumption plan</div><p>Now we should have a new app registration / Enterprise app populated in our tenant. Let’s <strong>tweak the app registration first</strong> because we have work to do:</p><ul><li>Under the <strong>Authentication</strong> menu, make sure:<ul><li>The redirect URI is populated (Part of the easy auth configuration).<li>The implicit flow is “disabled”. At least for our tests, we won’t need it.<li>Public app is selected. Doing this, you won’t have to provide secrets.</ul></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-02-10/04.png" alt="04" /></p><p>and in the bottom of the same page, you should see:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-02-10/05.png" alt="05" /></p><div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> If the concept of public app, app registration, enterprise app, single or multi-tenant is not clear for you, I recommend to read my previous article.</div><ul><li><p>Under <strong>certificates and secrets</strong>, you can <strong>remove the auto populated secret</strong>. Here, we will use a public app, we won’t need any secrets.</p><li><p>Under <strong>api permissions</strong>, you can <strong>remove every scope</strong>. Here we just want to validate the user (Id Token).</p></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-02-10/06.png" alt="06" /></p><ul><li>Under <strong>expose an API</strong>, make sure you have a <strong>user_impersonation scope</strong>. Required to use <strong>delegated permission</strong>.</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-02-10/07.png" alt="07" /></p><p>Now that our app registration is configured, let’s play ! Let’s generate a token with a <strong>public application flow</strong>. Here we will choose the <strong>devicecode</strong> one but if you prefer, you can use the <strong>authorization code</strong> instead.</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nv">$clientId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">&lt;</span><span class="n">Your</span><span class="w"> </span><span class="nx">AppId</span><span class="w"> </span><span class="nx">generated</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">easy</span><span class="w"> </span><span class="nx">auth</span><span class="err">&gt;</span><span class="w">
</span><span class="nv">$TenantId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">&lt;</span><span class="n">Your</span><span class="w"> </span><span class="nx">tenant</span><span class="w"> </span><span class="nx">Id</span><span class="err">&gt;</span><span class="w">
</span><span class="nv">$Scopes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://testfuncaadfanf.azurewebsites.net/user_impersonation"</span><span class="w"> </span><span class="c"># This is the URI you have into the expose an API menu in the app registration</span><span class="w">

</span><span class="c">#Our previous function call uri</span><span class="w">
</span><span class="nv">$Uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://testfuncaadfanf.azurewebsites.net/api/httpNoRole?code=EpogLPlkqeSiVlOOvQ73fAnHSfLC8ZSMMz4KrRpEcckNvgxCf/81fw==&amp;name=fanf"</span><span class="w"> </span><span class="c">#Not a real URL</span><span class="w">
</span><span class="c"># Generate interractive device code flow where with impersonation scope (on behalf of user)</span><span class="w">
</span><span class="nv">$token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-MsalToken</span><span class="w"> </span><span class="nt">-ClientId</span><span class="w"> </span><span class="nv">$clientId</span><span class="w"> </span><span class="nt">-TenantId</span><span class="w"> </span><span class="nv">$TenantId</span><span class="w"> </span><span class="nt">-Scopes</span><span class="w">  </span><span class="nv">$scopes</span><span class="w"> </span><span class="nt">-DeviceCode</span><span class="w">
</span><span class="c">#Generate headers</span><span class="w">
</span><span class="nv">$Headers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@{</span><span class="w">
    </span><span class="s1">'Authorization'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$(</span><span class="s2">"Bearer "</span><span class="w"> </span><span class="err">+</span><span class="w"> </span><span class="nv">$token</span><span class="err">.</span><span class="nx">AccessToken</span><span class="err">)</span><span class="w">
    </span><span class="s2">"Content-Type"</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s1">'application/json'</span><span class="w">
 </span><span class="p">}</span><span class="w">

</span><span class="c">#Invoke the function with the header</span><span class="w">
</span><span class="n">Invoke-RestMethod</span><span class="w"> </span><span class="nt">-Uri</span><span class="w"> </span><span class="nv">$URI</span><span class="w"> </span><span class="nt">-Headers</span><span class="w"> </span><span class="nv">$Headers</span><span class="w">

</span></pre></table></code></div></div><p>And you should see: <strong>Hello, fanf. This HTTP triggered function executed successfully</strong> instead of the previous 401. Now every local tenant users (normal or guest) can execute this function. Now, go in the Enterprise app to manage our application!</p><p>Once in the Enterprise app, select <strong>properties</strong> and <strong>enable User assignment required?</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-02-10/08.png" alt="08" /></p><p>Then under <strong>users and groups</strong>, select the <strong>users allowed to execute</strong> this function.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-02-10/09.png" alt="09" /></p><p>Now you can try with 2 different accounts and you will see that unallowed user will receive (sorry it’s in French, but long story short get out :p):</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/2021-02-10/10.png" alt="10" /></p><h1 id="conclusion">Conclusion</h1><p>As we’ve seen, the <strong>easy auth</strong> path is maybe <strong>not the good option because it generates unnecessary things</strong>, but it’s quicker. Starting today, I will do the advanced instead and tweak everything myself. I hope you’ve enjoyed this article, see you in the next one.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/identity/'>identity</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/identity/" class="post-tag no-text-decoration" >identity</a> <a href="/tags/powershell/" class="post-tag no-text-decoration" >Powershell</a> <a href="/tags/azuread/" class="post-tag no-text-decoration" >AzureAD</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How can I better protect my Azure functions with OAuth? - SCOMnewbie learnings&url=https://scomnewbie.github.io//posts/authenticatedazfunc/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How can I better protect my Azure functions with OAuth? - SCOMnewbie learnings&u=https://scomnewbie.github.io//posts/authenticatedazfunc/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=How can I better protect my Azure functions with OAuth? - SCOMnewbie learnings&url=https://scomnewbie.github.io//posts/authenticatedazfunc/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/usegraphapibatching/">Use Graph API batching to speed things up?</a><li><a href="/posts/adqueriesfromazure/">Execute AD queries protected by modern authentication from Azure without VPN</a><li><a href="/posts/createaadapplications/">Another way to create Azure AD applications</a><li><a href="/posts/passwordlesswitharc/">Passwordless deployment from anywhere with Azure ARC</a><li><a href="/posts/registrationvsenterpriseapp/">Deep dive into modern application</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/powershell/">Powershell</a> <a class="post-tag" href="/tags/identity/">identity</a> <a class="post-tag" href="/tags/aad/">AAD</a> <a class="post-tag" href="/tags/azuread/">AzureAD</a> <a class="post-tag" href="/tags/arc/">ARC</a> <a class="post-tag" href="/tags/cli/">CLI</a> <a class="post-tag" href="/tags/container/">Container</a> <a class="post-tag" href="/tags/devops/">Devops</a> <a class="post-tag" href="/tags/graph/">Graph</a> <a class="post-tag" href="/tags/graphapi/">GraphAPI</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/registrationvsenterpriseapp/"><div class="card-body"> <span class="timeago small" > Feb 8 <i class="unloaded">2021-02-08T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Deep dive into modern application</h3><div class="text-muted small"><p> Introduction At the beginning, I’ve wanted to talk about what an application is and how to create it in a single article. Then I’ve started to realize that it’s maybe not a good idea… So, let’s st...</p></div></div></a></div><div class="card"> <a href="/posts/roleswithazfunc/"><div class="card-body"> <span class="timeago small" > Feb 10 <i class="unloaded">2021-02-10T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Add roles to an Azure function?</h3><div class="text-muted small"><p> Introduction Following the previous post where I’ve enabled OAUth on an azure function with easy auth, few minutes after I had another idea… The problem? I have no idea if it’s stupid or if it’s a...</p></div></div></a></div><div class="card"> <a href="/posts/apiwithpode/"><div class="card-body"> <span class="timeago small" > Jul 7 <i class="unloaded">2021-07-07T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Build a Powershell API with Pode</h3><div class="text-muted small"><p> Introduction I’ve tried to explain previously how to secure a backend api where I’ve used Azure functions to demonstrate how to protect it, but what if we’re not on Azure? I know you can run the A...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/registrationvsenterpriseapp/" class="btn btn-outline-primary"><p>Deep dive into modern application</p></a> <a href="/posts/roleswithazfunc/" class="btn btn-outline-primary"><p>Add roles to an Azure function?</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/fanfleon">Francois LEON</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/powershell/">Powershell</a> <a class="post-tag" href="/tags/identity/">identity</a> <a class="post-tag" href="/tags/aad/">AAD</a> <a class="post-tag" href="/tags/azuread/">AzureAD</a> <a class="post-tag" href="/tags/arc/">ARC</a> <a class="post-tag" href="/tags/cli/">CLI</a> <a class="post-tag" href="/tags/container/">Container</a> <a class="post-tag" href="/tags/devops/">Devops</a> <a class="post-tag" href="/tags/graph/">Graph</a> <a class="post-tag" href="/tags/graphapi/">GraphAPI</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://scomnewbie.github.io/{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
